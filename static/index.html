<?xml encoding='utf-8' version='1.0'?>
<html>
 <body>
  <h1>BrewGear &pi;</h1>

  <div id="chart" style="width:100%; height:400px;"></div>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script src="http://code.highcharts.com/highcharts.js"></script>

  <script type="text/javascript">
$(function () {
        $('#chart').highcharts({
            chart: {
                zoomType: 'xy',
                type: 'spline',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
                    load: function() {
                        // set up the updating of the chart each second
                        var temperature_series = this.series[0];
                        var heater_series = this.series[1];
                        var callback = function () {
                            $.get("/reading", function (data, textStatus, jqXHR) {
				var d = Date.parse(data.time);
				temperature_series.addPoint([d, data.temperature], true, false);
				heater_series.addPoint([d, data.heater], true, false);
				setTimeout(callback, 2000);
				console.log(data);
			    });
                        };
			setTimeout(callback, 2000);
                    }
                }
            },

            title: {
                text: 'Mash'
            },
            legend: {
                enabled: false
            },
            xAxis: [{
                type: 'datetime',
                title: {
                    text: 'Time',
                },
                dateTimeLabelFormats: {
                    month: '%M:%S',
                    year: '%b'
                }
            }],
            yAxis: [{
                labels: {
                    style: {
                        color: '#89A54E'
                    }
                },
                title: {
                    text: 'Temperature',
                    style: {
                        color: '#89A54E'
                    }
                }
            }, {
                gridLineWidth: 0,
                type: 'area',
                title: {
                    text: 'Heater',
                    style: {
                        color: '#4572A7'
                    },
                },
                labels: {
                    formatter: function() {
                        return this.value === 0 ? 'Off' : (this.value === 1 ? 'On' : '');
                    },
                    style: {
                        color: '#4572A7'
                    },
                    tickInterval: 1
                },
                min: 0,
                max: 1,
                opposite: true
            }],
            tooltip: {
                shared: true
            },
            plotOptions: {
		series: {
		    stacking: null
		}
	    },
            series: [{
                name: 'Temperature',
                color: '#89A54E',
                tooltip: {
                    valueSuffix: ' Â°C'
                },
		data: []
            }, {
                name: 'Heater',
                color: '#4572A7',
                yAxis: 1,
		data: []
            }]
        });
    });
  </script>
 </body>
</html>
